{
  "entities": {
    "Match": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Match",
      "type": "object",
      "description": "Represents a football match.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the match."
        },
        "compId": {
          "type": "string",
          "description": "Reference to the Competition. (Relationship: Competition 1:N Match)"
        },
        "homeTeamId": {
          "type": "string",
          "description": "Reference to the Home Team. (Relationship: Team 1:N Match (Home Team))"
        },
        "awayTeamId": {
          "type": "string",
          "description": "Reference to the Away Team. (Relationship: Team 1:N Match (Away Team))"
        },
        "date": {
          "type": "string",
          "description": "Date and time of the match.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the match (e.g., 'FT', 'NS')."
        },
        "score": {
          "type": "string",
          "description": "Score of the match (e.g., '2-1')."
        }
      },
      "required": [
        "id",
        "compId",
        "homeTeamId",
        "awayTeamId",
        "date",
        "status",
        "score"
      ]
    },
    "Competition": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Competition",
      "type": "object",
      "description": "Represents a football competition.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the competition."
        },
        "name": {
          "type": "string",
          "description": "Name of the competition."
        },
        "continent": {
          "type": "string",
          "description": "Continent the competition belongs to."
        },
        "apiFootballId": {
          "type": "number",
          "description": "ID from the API Football API."
        },
        "isFavoritedBy": {
          "type": "array",
          "description": "References to Users who have favorited this competition. (Relationship: User N:N Competition)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "continent",
        "apiFootballId"
      ]
    },
    "Team": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Team",
      "type": "object",
      "description": "Represents a football team.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the team."
        },
        "name": {
          "type": "string",
          "description": "Name of the team."
        },
        "originalId": {
          "type": "number",
          "description": "Original ID from the API Football API."
        },
        "customNameByAdmin": {
          "type": "string",
          "description": "Custom name given by an admin."
        },
        "favoriteBy": {
          "type": "array",
          "description": "References to Users who have favorited this team. (Relationship: User N:N Team)",
          "items": {
            "type": "string"
          }
        },
        "notes": {
          "type": "array",
          "description": "Notes about the team, with user ID as key",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "originalId"
      ]
    },
    "News": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "News",
      "type": "object",
      "description": "Represents a news article.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the news article."
        },
        "title": {
          "type": "string",
          "description": "Title of the news article."
        },
        "body": {
          "type": "string",
          "description": "Content of the news article."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the news article's image.",
          "format": "uri"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the Admin who wrote the article. (Relationship: Admin 1:N News)"
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time the article was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "body",
        "imageUrl",
        "authorId",
        "createdAt"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "permissions": {
          "type": "string",
          "description": "Permissions granted to the admin (e.g., manageCompetitions, manageNews)."
        }
      },
      "required": [
        "id",
        "permissions"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "favorites": {
          "type": "string",
          "description": "User's favorite teams and competitions (denormalized references).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/competitions/{competitionId}",
        "definition": {
          "entityName": "Competition",
          "schema": {
            "$ref": "#/backend/entities/Competition"
          },
          "description": "Stores competition data. Includes denormalized 'isFavoritedBy' array for authorization independence.",
          "params": [
            {
              "name": "competitionId",
              "description": "Unique identifier for the competition."
            }
          ]
        }
      },
      {
        "path": "/teams/{teamId}",
        "definition": {
          "entityName": "Team",
          "schema": {
            "$ref": "#/backend/entities/Team"
          },
          "description": "Stores team data. Includes denormalized 'favoriteBy' array for authorization independence.",
          "params": [
            {
              "name": "teamId",
              "description": "Unique identifier for the team."
            }
          ]
        }
      },
      {
        "path": "/matches/{matchId}",
        "definition": {
          "entityName": "Match",
          "schema": {
            "$ref": "#/backend/entities/Match"
          },
          "description": "Stores match data.",
          "params": [
            {
              "name": "matchId",
              "description": "Unique identifier for the match."
            }
          ]
        }
      },
      {
        "path": "/news/{newsId}",
        "definition": {
          "entityName": "News",
          "schema": {
            "$ref": "#/backend/entities/News"
          },
          "description": "Stores news articles. 'authorId' indicates the admin who created the news article.",
          "params": [
            {
              "name": "newsId",
              "description": "Unique identifier for the news article."
            }
          ]
        }
      },
      {
        "path": "/admins/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores admin user data. Existence of a document indicates admin role.",
          "params": [
            {
              "name": "adminId",
              "description": "Unique identifier for the admin user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Goal Stack application, emphasizing real-time data synchronization, efficient data retrieval, and robust security. The structure incorporates denormalization to ensure Authorization Independence, eliminates the need for `get()` calls in security rules, and promotes atomic operations. It uses structural segregation for a homogeneous security posture and leverages access modeling with path-based ownership and membership maps.\n\n**Authorization Independence (Denormalization):**\n*   The `isFavoritedBy` array within the `/competitions/{competitionId}` documents denormalizes the user's favorite competitions, removing the need to access the user document to determine favorite competitions. Similarly, `/teams/{teamId}` includes `favoriteBy`.\n*   The `authorId` field in the `/news/{newsId}` collection indicates the author. An admin role check is performed on the `admins` collection.\n\n**Structural Segregation:**\n*   The `/news` collection is segregated for global news articles, with admin-only write access. User-specific data, like favorites, is stored under `/users/{userId}`.\n*   Admin-specific data (permissions) is stored in `/admins/{adminId}`, separate from user profiles.\n\n**Access Modeling:**\n*   Private user data (favorites) is stored using path-based ownership under `/users/{userId}`.\n*   Admin roles are managed using the existence of documents in the `/admins/{adminId}` collection, providing a simple and secure way to manage admin privileges using DBAC principles.\n\n**QAPs Support:**\n*   List operations are secured by structural segregation. Listing news requires admin privileges. Listing competitions/teams might require authentication (depending on public/private requirements for these). User-specific data is secured via path-based rules.\n*   The membership map and denormalization strategies avoid `get()` calls, preventing rule evaluation from turning into data filters.\n\n**Invariants:**\n*   Timestamps are used for `createdAt` in the `/news` collection to maintain the integrity of article creation times.\n*   Ownership of news articles is maintained via the `authorId` field and the admin check."
  }
}